<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/html">
<head>
    <title></title>
</head>
<body>
<form action="" method="GET">
    <div id="statistic-area"></div>
        <label for="statistic">Statistic:</label>
        <select id="statistic">
            {% for stat in statistics %}
                <option value="{{ stat }}">{{ stat }}</option>
            {% endfor %}
        </select>
    </div>

    <div id="state-area">
        <label for="state">State:</label>
        <select id="state">
            {% for elem in states %}
                <option value="{{ elem.state }}">{{ elem.NAME }}</option>
            {% endfor %}
        </select>
        <button class="get_data">Get Data</button>
    </div>

    <div id="county-area">
        <label for="county">County:</label>
        <select id="county">
            {% for county in counties %}
                <option value="{{ county.state }},{{ county.county }}">{{ county.STATE_NAME }}, {{ county.NAME }}</option>
            {% endfor %}
        </select>
        <button  class="get_data">Get Data</button>
    </div>

    <div id="msa-area">
        <label for="msa">MSA:</label>
        <select id="msa">
            {% for msa in msas %}
                <option value="{{ msa.state }},{{ msa.msa_code }},">{{ msa.STATE_NAME }}, {{ msa.NAME }}</option>
            {% endfor %}
        </select>
        <button  class="get_data">Get Data</button>
    </div>



    <div id="table-area"></div>

    </div>
</form>

<script type="text/template" id="template-table">
    <h6>"<%= stat_name %>" for <%= area %></h6>
    <table>
        <tbody>
            <% _.each(table_data, function(elem) { %>
            <tr>
                <td><%= elem[1] %></td>
                <td><%= elem[2] %></td>
            </tr>
            <% }); %>
        </tbody>
    </table>
</script>



<script type="text/javascript" src="/static/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="/static/underscore.js"></script>
<script type="text/javascript">
    $(function(){
        $("button.get_data").click(function(event){
            event.preventDefault();
            $("#table-area").html("");
            var statistic_selected = $("option:selected", $("#statistic"));
            var geo_region_selected = $("option:selected", $(this).siblings("select"));
            $.getJSON("/stat/" +
                    geo_region_selected.attr("value") + "/" +
                    statistic_selected.attr("value") + "/",
                    function(data){
                        var table_data = _.template(
                            $("#template-table").html(),
                            {table_data: data, stat_name: statistic_selected.text(), area: geo_region_selected.text()}
                        );
                        $("#table-area").html(table_data);
                    });

        });

    });
</script>
</body>
</html>